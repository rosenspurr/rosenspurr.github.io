<div class="gallery">
    {% assign all_items = "" | split: "" %} {% comment %} If the page has a
    category (page.category), filter posts. Otherwise, use all posts (default
    gallery view). {% endcomment %} {% if page.category %} {% assign
    posts_to_show = site.posts | where_exp: "post", "post.categories contains
    page.category" %} {% else %} {% assign posts_to_show = site.posts %} {%
    endif %} {% for post in posts_to_show %} {% if post.images %} {% for img in
    post.images %} {% assign item_info = img | append: "|" | append: post.url |
    append: "#img-" | append: forloop.index %} {% assign all_items = all_items |
    push: item_info %} {% endfor %} {% endif %} {% endfor %} {% assign
    shuffled_items = all_items | sample: all_items.size %} {% for item in
    shuffled_items %} {% assign parts = item | split: "|" %} {% assign src =
    parts[0] %} {% assign anchor_url = parts[1] %}

    <a href="{{ anchor_url }}">
        {% if src contains ".mp4" or src contains ".webm" %}
        <video
            src="{{ src }}"
            controls
            loop
            autoplay
            muted
            playsinline
            style="
                width: 100%;
                height: auto;
                display: block;
                margin-bottom: 6px;
            "
        >
            Your browser does not support the video tag.
        </video>
        {% else %}
        <img src="{{ src }}" alt="" />
        {% endif %}
    </a>
    {% endfor %}
</div>

<style>
    .gallery {
        columns: 2;
        column-gap: 6px;
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
    }

    .gallery a {
        display: inline-block;
        width: 100%;
        margin: 0 0 6px;
        break-inside: avoid;
    }

    .gallery img,
    .gallery video {
        width: 100%;
        height: auto;
        display: block;
        object-fit: cover;
    }

    @media (max-width: 700px) {
        .gallery {
            columns: 1;
        }
    }
</style>
